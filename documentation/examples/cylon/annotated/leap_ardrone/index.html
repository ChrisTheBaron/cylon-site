<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html ng-app="cylon">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta content="A Cylon.JS code example" name="description">
    <meta content="The Hybrid Group" name="author">
    <title>Cylon.JS Example - Leapmotion Ardrone 2.0</title>
    <link href="/stylesheets/style.css" rel="stylesheet">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="/hybridpages/assets/javascript/plax.js"></script>
    <script src="/javascripts/parallax_bottom.js"></script>
    <script src="/javascripts/vendor/angular.min.js"></script>
    <script src="/javascripts/app.js"></script>
    <link href="//fonts.googleapis.com/css?family=Inconsolata:400,700%7CMontserrat:700" rel="stylesheet">
    <link href="/favicon.ico" rel="shortcut icon" type="image/gif">
  <script type="text/javascript">


  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46433484-2', {"cookieDomain":"cylonjs.com"});
















   ga('send', 'pageview');


</script></head>
  <body>
    
    <div class="app">
      <div id="top-header">
        <div class="back-index-top">
          <div class="container-hero section-nav">
            <div class="w">
              <header class="app-header" role="banner">
                <div class="display">
                  <h1 class="app-logo">
                    <a href="/">Cylon</a>
                  </h1>
                  <span class="subtitle">
                    <div class="main"></div>
                  </span>
                </div>
                <span class="menu">
                  <a class="active" href="/documentation">Docs</a>
                  <a href="/documentation/platforms" class="item">Platforms</a>
                  <a href="/resources" class="item">Resources</a>
                  <a href="/blog" class="item">Blog</a>
                  <a class="item" target="_blank" href="https://github.com/hybridgroup/cylon/">Github</a>
                </span>
              </header>
            </div>
          </div>
        </div>
      </div>
      <div class="container">
        <div class="main" role="main">
          <section class="content full">
            <div class="documentation">
              <div class="side-documentation">
                <div class="mobile-menu">
                  <a id="docs-menu">
                    <div class="line"></div>
                    <div class="line"></div>
                    <div class="line"></div>
                  </a>
                </div>
                <nav class="docs-sidebar" ng-controller="SidebarCtrl">
                  <a href="/documentation/getting-started">Getting Started</a>
                  <div class="section" ng-class="{active: active('Guides')}">
                    <div class="name" ng-click="show('Guides')">Guides</div>
                    <div class="links" ng-show="active('Guides')">
                      <a href="/documentation/guides/what_is_cylon">About Cylon</a>
                      <a href="/documentation/guides/working-with-robots">Working With Robots</a>
                      <a href="/documentation/guides/api">API</a>
                      <a href="/documentation/guides/cli">CLI</a>
                      <a href="/documentation/guides/test-driven-robotics">Test-Driven Robotics</a>
                      <a href="/documentation/guides/helpers">Helper Methods</a>
                    </div>
                  </div>
                  <div class="section" ng-class="{active: active('Platforms')}">
                    <div class="name" ng-click="show('Platforms')">Platforms</div>
                    <div class="links" ng-show="active('Platforms')">
                      <a href="/documentation/platforms/ardrone">Ardrone</a>
                      <a href="/documentation/platforms/arduino">Arduino</a>
                      <a href="/documentation/platforms/yun">Arduino Yun</a>
                      <a href="/documentation/platforms/audio">Audio</a>
                      <a href="/documentation/platforms/beaglebone">Beaglebone</a>
                      <a href="/documentation/platforms/crazyflie">Crazyflie</a>
                      <a href="/documentation/platforms/digispark">Digispark</a>
                      <a href="/documentation/platforms/force">Force</a>
                      <a href="/documentation/platforms/galileo">Intel Galileo</a>
                      <a href="/documentation/platforms/edison">Intel Edison</a>
                      <a href="/documentation/platforms/joystick">Joystick</a>
                      <a href="/documentation/platforms/keyboard">Keyboard</a>
                      <a href="/documentation/platforms/leapmotion">Leap Motion</a>
                      <a href="/documentation/platforms/m2x">M2X</a>
                      <a href="/documentation/platforms/nest">Nest</a>
                      <a href="/documentation/platforms/neurosky">Neurosky Mindwave</a>
                      <a href="/documentation/platforms/opencv">OpenCV</a>
                      <a href="/documentation/platforms/pebble">Pebble</a>
                      <a href="/documentation/platforms/pinoccio">Pinoccio</a>
                      <a href="/documentation/platforms/rapiro">Rapiro</a>
                      <a href="/documentation/platforms/raspberry-pi">Raspberry Pi</a>
                      <a href="/documentation/platforms/skynet">Skynet</a>
                      <a href="/documentation/platforms/spark">Spark</a>
                      <a href="/documentation/platforms/sphero">Sphero</a>
                      <a href="/documentation/platforms/speech">Speech</a>
                      <a href="/documentation/platforms/tessel">Tessel</a>
                    </div>
                  </div>
                  <div class="section" ng-class="{active: active('Drivers')}">
                    <div class="name" ng-click="show('Drivers')">Drivers</div>
                    <div class="links" ng-show="active('Drivers')">
                      <div class="sub-section">
                        <div class="name">GPIO</div>
                        <div class="links">
                          <a href="/documentation/drivers/analog-sensor">Analog Sensor</a>
                          <a href="/documentation/drivers/button">Button</a>
                          <a href="/documentation/drivers/continuous-servo">Continuous Servo</a>
                          <a href="/documentation/drivers/direct-pin">Direct Pin</a>
                          <a href="/documentation/drivers/ir-range-finder">Sharp IR Proximity Sensor</a>
                          <a href="/documentation/drivers/led">LED</a>
                          <a href="/documentation/drivers/makey-button">Makey Button</a>
                          <a href="/documentation/drivers/maxbotix">Maxbotix</a>
                          <a href="/documentation/drivers/motor">Motor</a>
                          <a href="/documentation/drivers/servo">Servo</a>
                        </div>
                      </div>
                      <div class="sub-section">
                        <div class="name">I2C</div>
                        <div class="links">
                          <a href="/documentation/drivers/blinkm">BlinkM</a>
                          <a href="/documentation/drivers/bmp180">BPM180</a>
                          <a href="/documentation/drivers/hmc6352-compass">HMC6352 Compass</a>
                          <a href="/documentation/drivers/lcd">LCD</a>
                          <a href="/documentation/drivers/lsm9ds0g">LSM9DS0G</a>
                          <a href="/documentation/drivers/lsm9ds0xm">LSM9DS0XM</a>
                          <a href="/documentation/drivers/mpl115a2">MPL115A2</a>
                          <a href="/documentation/drivers/mpu6050">MPU6050</a>
                        </div>
                      </div>
                      <a href="/documentation/drivers/ardrone">Ardrone - Flight</a>
                      <a href="/documentation/drivers/ardrone-navigation">Ardrone - Navigation</a>
                      <a href="/documentation/drivers/crazyflie">Crazyflie</a>
                      <a href="/documentation/drivers/force">Force</a>
                      <a href="/documentation/drivers/dualshock">Joystick - DualShock 3</a>
                      <a href="/documentation/drivers/xbox360">Joystick - Xbox 360</a>
                      <a href="/documentation/drivers/keyboard">Keyboard</a>
                      <a href="/documentation/drivers/leapmotion">Leap Motion</a>
                      <a href="/documentation/platforms/m2x">M2X</a>
                      <a href="/documentation/drivers/nest-home">Nest - Home</a>
                      <a href="/documentation/drivers/nest-thermostat">Nest - Thermostat</a>
                      <a href="/documentation/drivers/neurosky">Neurosky Mindwave</a>
                      <a href="/documentation/drivers/pebble">Pebble</a>
                      <a href="/documentation/drivers/pinoccio-led">Pinoccio - LED</a>
                      <a href="/documentation/drivers/pinoccio-power">Pinoccio - Power</a>
                      <a href="/documentation/drivers/rapiro">Rapiro</a>
                      <a href="/documentation/drivers/skynet">Skynet</a>
                      <a href="/documentation/drivers/sphero">Sphero</a>
                      <div class="sub-section">
                        <div class="name">Tessel</div>
                        <div class="links">
                          <a href="/documentation/drivers/tessel-accelerometer">Accelerometer</a>
                          <a href="/documentation/drivers/tessel-ambient">Ambient</a>
                          <a href="/documentation/drivers/tessel-audio">Audio</a>
                          <a href="/documentation/drivers/tessel-bluetooth">Bluetooth</a>
                          <a href="/documentation/drivers/tessel-camera">Camera</a>
                          <a href="/documentation/drivers/tessel-gps">GPS</a>
                          <a href="/documentation/drivers/tessel-infrared">Infrared</a>
                          <a href="/documentation/drivers/tessel-relay">Relay</a>
                          <a href="/documentation/drivers/tessel-servo">Servo</a>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="section" ng-class="{active: active('Contribute')}">
                    <div class="name" ng-click="show('Contribute')">Contribute</div>
                    <div class="links" ng-show="active('Contribute')">
                      <a href="/documentation/contribute/guidelines">Guidelines</a>
                      <a href="/documentation/contribute/contact-us">Contact Us</a>
                    </div>
                  </div>
                  <a href="/documentation/examples">Examples</a>
                  <a href="/documentation/tutorials">Tutorials</a>
                  <a href="/documentation/chat">Chat</a>
                </nav>
              </div>
              <div class="container-documentation">
                
                <h1 id="leapmotion-ardrone-20">Leapmotion Ardrone 2.0</h1>
                
                <p>This example illustrates how to use Leap Motion and the keyboard to control an ARDrone. We basically use one hand to drive the drone (takeoff, land, up, down, etc) and the arrow keys to perform some cool stunts (flips).</p>
                
                <p>First, let's import Cylon:</p>
                
                <pre class="CodeRay"><span class="keyword">var</span> Cylon = require(<span class="string"><span class="delimiter">'</span><span class="content">cylon</span><span class="delimiter">'</span></span>);
</pre>
                
                <p>Now that we have Cylon imported, we can start defining our robot</p>
                
                <pre class="CodeRay">Cylon.robot({
</pre>
                
                <p>Let's define the connections and devices:</p>
                
                <pre class="CodeRay">connections: [
    { <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">leapmotion</span><span class="delimiter">'</span></span>, <span class="key">adaptor</span>: <span class="string"><span class="delimiter">'</span><span class="content">leapmotion</span><span class="delimiter">'</span></span>, <span class="key">port</span>: <span class="string"><span class="delimiter">'</span><span class="content">127.0.0.1:6437</span><span class="delimiter">'</span></span> },
    { <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">ardrone</span><span class="delimiter">'</span></span>, <span class="key">adaptor</span>: <span class="string"><span class="delimiter">'</span><span class="content">ardrone</span><span class="delimiter">'</span></span>, <span class="key">port</span>: <span class="string"><span class="delimiter">'</span><span class="content">192.168.1.1</span><span class="delimiter">'</span></span> },
    { <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">keyboard</span><span class="delimiter">'</span></span>, <span class="key">adaptor</span>: <span class="string"><span class="delimiter">'</span><span class="content">keyboard</span><span class="delimiter">'</span></span> }
],
<span class="key">devices</span>: [
    { <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">drone</span><span class="delimiter">'</span></span>, <span class="key">driver</span>: <span class="string"><span class="delimiter">'</span><span class="content">ardrone</span><span class="delimiter">'</span></span>, <span class="key">connection</span>:<span class="string"><span class="delimiter">'</span><span class="content">ardrone</span><span class="delimiter">'</span></span> },
    { <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">leapmotion</span><span class="delimiter">'</span></span>, <span class="key">driver</span>: <span class="string"><span class="delimiter">'</span><span class="content">leapmotion</span><span class="delimiter">'</span></span>, <span class="key">connection</span>:<span class="string"><span class="delimiter">'</span><span class="content">leapmotion</span><span class="delimiter">'</span></span> },
    { <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">keyboard</span><span class="delimiter">'</span></span>, <span class="key">driver</span>: <span class="string"><span class="delimiter">'</span><span class="content">keyboard</span><span class="delimiter">'</span></span>, <span class="key">connection</span>:<span class="string"><span class="delimiter">'</span><span class="content">keyboard</span><span class="delimiter">'</span></span>}
],
</pre>
                
                <p>Now that Cylon knows about the necessary hardware we're going to be using, we'll
                tell it what work we want to do:</p>
                
                <pre class="CodeRay">  <span class="function">work</span>: <span class="keyword">function</span>(my) {
</pre>
                
                <p>Lets use the circle gesture to take off and land : two rounds clockwise will trigger the takeoff() and counter clockwise will tell the drone to land: </p>
                
                <pre class="CodeRay">    my.leapmotion.on(<span class="string"><span class="delimiter">'</span><span class="content">gesture</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>(gesture) {
        <span class="keyword">if</span> (gesture.type==<span class="string"><span class="delimiter">'</span><span class="content">circle</span><span class="delimiter">'</span></span> &amp;&amp; gesture.state==<span class="string"><span class="delimiter">'</span><span class="content">stop</span><span class="delimiter">'</span></span> &amp;&amp; gesture.progress &gt; CIRCLE_THRESHOLD ){
            <span class="keyword">if</span> (gesture.normal[<span class="integer">2</span>] &lt; <span class="integer">0</span>) {
                my.drone.takeoff();
            };

            <span class="keyword">if</span> (gesture.normal[<span class="integer">2</span>] &gt; <span class="integer">0</span>) {
                my.drone.land();
            }
        }
    });
</pre>
                
                <p>Whenever we get a 'hand' gesture event from Leap Motion we need to tell ARDrone what to do. </p>
                
                <pre class="CodeRay">    my.leapmotion.on(<span class="string"><span class="delimiter">'</span><span class="content">hand</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>(hand) {
</pre>
                
                <p>In case we turn our hand to the right or left we want the drone to rotate clockwise or counter clockwise respectively:</p>
                
                <pre class="CodeRay">    <span class="keyword">if</span>(hand.s&gt;<span class="float">1.5</span> &amp;&amp; Math.abs(handStartDirection[<span class="integer">0</span>]-hand.direction[<span class="integer">0</span>]) &gt; TURN_TRESHOLD ) {
        <span class="keyword">var</span> signal = handStartDirection[<span class="integer">0</span>]-hand.direction[<span class="integer">0</span>];
        <span class="keyword">var</span> value = (Math.abs(handStartDirection[<span class="integer">0</span>]-hand.direction[<span class="integer">0</span>])-TURN_TRESHOLD) * TURN_SPEED_FACTOR;
        <span class="keyword">if</span> (signal&gt;<span class="integer">0</span>){
            my.drone.counterClockwise(value);
        }

        <span class="keyword">if</span> (signal&lt;<span class="integer">0</span>){
            my.drone.clockwise(value);
        }      
    }
</pre>
                
                <p>In case we raise our hand up or lower it down we tell the drone to go up or down respectively:</p>
                
                <pre class="CodeRay">    <span class="keyword">if</span> (hand.s&gt;<span class="float">1.5</span> &amp;&amp; Math.abs(hand.palmPosition[<span class="integer">1</span>]-handStartPosition[<span class="integer">1</span>]) &gt; UP_CONTROL_THRESHOLD) {    
        <span class="keyword">var</span> signal = (hand.palmPosition[<span class="integer">1</span>]-handStartPosition[<span class="integer">1</span>]) &gt;= <span class="integer">0</span> ? <span class="integer">1</span> : -<span class="integer">1</span>;
        <span class="keyword">var</span> value = Math.round(Math.abs((hand.palmPosition[<span class="integer">1</span>]-handStartPosition[<span class="integer">1</span>]))-UP_CONTROL_THRESHOLD) * UP_SPEED_FACTOR;

        <span class="keyword">if</span> (signal&gt;<span class="integer">0</span>) {
            my.drone.up(value);
        };

        <span class="keyword">if</span> (signal&lt;<span class="integer">0</span>) {
            my.drone.down(value);
        }
    }
</pre>
                
                <p>In order to move the drone forward, backward, left or right we need to detect the hand inclination. Imagine your hand is the drone and lean it towards the direction we want it to move.</p>
                
                <pre class="CodeRay">    <span class="keyword">if</span> (hand.s&gt;<span class="float">1.5</span> &amp;&amp; (Math.abs(hand.palmNormal[<span class="integer">2</span>])&gt;DIRECTION_THRESHOLD)) {
        <span class="keyword">if</span> (hand.palmNormal[<span class="integer">2</span>]&gt;<span class="integer">0</span>) {
            <span class="keyword">var</span> value = Math.abs(Math.round( hand.palmNormal[<span class="integer">2</span>] * <span class="integer">10</span> + DIRECTION_THRESHOLD ) * DIRECTION_SPEED_FACTOR);
            my.drone.forward( value );
        };
    
        <span class="keyword">if</span> (hand.palmNormal[<span class="integer">2</span>]&lt;<span class="integer">0</span>) {
            <span class="keyword">var</span> value = Math.abs(Math.round( hand.palmNormal[<span class="integer">2</span>] * <span class="integer">10</span> - DIRECTION_THRESHOLD ) * DIRECTION_SPEED_FACTOR);
            my.drone.back( value );
        };
    } 

    <span class="keyword">if</span> (hand.s&gt;<span class="float">1.5</span> &amp;&amp; (Math.abs(hand.palmNormal[<span class="integer">0</span>])&gt;DIRECTION_THRESHOLD)) {
        <span class="keyword">if</span> (hand.palmNormal[<span class="integer">0</span>]&gt;<span class="integer">0</span>) {
            <span class="keyword">var</span> value = Math.abs(Math.round( hand.palmNormal[<span class="integer">0</span>] * <span class="integer">10</span> + DIRECTION_THRESHOLD ) * DIRECTION_SPEED_FACTOR);
            my.drone.left( value );
        };
    
        <span class="keyword">if</span> (hand.palmNormal[<span class="integer">0</span>]&lt;<span class="integer">0</span>) {
            <span class="keyword">var</span> value = Math.abs(Math.round( hand.palmNormal[<span class="integer">0</span>] * <span class="integer">10</span> - DIRECTION_THRESHOLD ) * DIRECTION_SPEED_FACTOR);
            my.drone.right( value );
        };
    }
</pre>
                
                <p>Whenever we close our hand we tell the drone no stop:</p>
                
                <pre class="CodeRay">    <span class="keyword">if</span> (hand.s&lt;=<span class="float">1.5</span> &amp;&amp; lastS &gt; <span class="float">1.5</span>) { <span class="comment">// closed hand</span>
        my.drone.stop();
    }
</pre>
                
                <p>And finally lets use the arrow keys to tell the drone to do some cool stunts:</p>
                
                <pre class="CodeRay">    my.keyboard.on(<span class="string"><span class="delimiter">'</span><span class="content">right</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>(key) { 
        my.drone.rightFlip();
    });

    my.keyboard.on(<span class="string"><span class="delimiter">'</span><span class="content">left</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>(key) { 
        my.drone.leftFlip();
    });

    my.keyboard.on(<span class="string"><span class="delimiter">'</span><span class="content">up</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>(key) { 
        my.drone.frontFlip();
    });

    my.keyboard.on(<span class="string"><span class="delimiter">'</span><span class="content">down</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>(key) { 
        my.drone.backFlip();
    });
</pre>
                
                <p>Now that our robot knows what work to do, and the work it will be doing that
                hardware with, we can start it:</p>
                
                <pre class="CodeRay">    }).start();
</pre>
              </div>
            </div>
          </section>
        </div>
      </div>
    </div>
    <div class="app-footer">
      <div class="frameworks">
        <div class="parallax-container">
          <div class="background-footer parallax-bottom"></div>
        </div>
        <div class="container">
          <div class="column-footer">
            <div class="img">
              <img src="/images/elements/logo-cylon-2x.png">
            </div>
            <h4>Multiple solutions</h4>
            <p>Cylon provides a simple, yet powerful way to create solutions that incorporate multiple, different hardware devices at the same time.</p>
          </div>
          <div class="column-footer">
            <div class="img">
              <img src="/images/elements/logo-artoo-2x.png">
            </div>
            <h4>Artoo</h4>
            <p>Want to use Ruby on robots? Check out our sister project Artoo</p>
            <div class="button">
              <a target="blank" href="http://artoo.io">View Project</a>
            </div>
          </div>
          <div class="column-footer">
            <div class="img">
              <img src="/images/elements/logo-gobot-2x.png">
            </div>
            <h4>Gobot</h4>
            <p>Want to use the Go programming language to power your robots? Check out our sister project Gobot</p>
            <div class="button">
              <a target="blank" href="http://gobot.io">View Project</a>
            </div>
          </div>
          <div class="clear"></div>
        </div>
      </div>
      <div class="copyright">
        <div class="container">
          <div class="left-side">
            <span>© Copyright 2012-2014</span>
            <a href="http://hybridgroup.com" id="THG-logo" target="_blank">
              <img alt="The Hybrid Group" src="/images/elements/THG_logo.png">
            </a>
          </div>
          <div class="right-side">
            <a href="#top">
              <img alt="Top" src="/images/elements/triangle_up.svg">
              <p>Top</p>
            </a>
          </div>
          <div class="clear"></div>
        </div>
      </div>
    </div>
  </body>
</html>
